<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mabinogi èˆªç­ç›£æ¸¬ - ç™»èˆ¹ç‹€æ…‹ç‰ˆ</title>
    <style>
        :root {
            /* ç¶“å…¸ç‘ªå¥‡é…è‰² */
            --mabi-bg: #5ca4ce; --mabi-header: #4b8dc5; --mabi-border: #133c5a;
            --mabi-list-bg: #32648a; --mabi-highlight: #9fe2fb;
            --text-dark: #133c5a; --timer-yellow: #fde047;
            --sidebar-bg: #1a202c;
            
            /* ç‹€æ…‹é…è‰² */
            --status-boarding: #10b981; /* é–‹æ”¾ç™»èˆ¹ - ç¶ è‰² */
            --status-atsea: #3b82f6;    /* æœªåˆ°æ¸¯ - è—è‰² */
            
            /* å‹•æ…‹å­—é«”èˆ‡ä½ˆå±€ */
            --base-font: clamp(14px, 1.2vw, 22px);
            --title-font: clamp(16px, 1.5vw, 26px);
            --timer-font: clamp(15px, 1.4vw, 24px);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: "Microsoft JhengHei", sans-serif; background-color: #0f172a; 
            margin: 0; display: flex; flex-direction: column; height: 100vh;
            color: white; font-size: var(--base-font);
        }

        /* --- é ‚éƒ¨å·²åˆ°æ¸¯æ¨™ç±¤å€ --- */
        .alerts-container {
            position: sticky; top: 0; z-index: 1000;
            background-color: #1e293b; border-bottom: 3px solid var(--status-boarding);
            padding: 15px 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.6);
        }
        .alert-label { color: var(--status-boarding); font-weight: bold; margin-bottom: 8px; font-size: 1.1em; }
        .grid-tags { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag-boarding { 
            background: var(--status-boarding); padding: 6px 12px; border-radius: 6px; 
            font-size: 0.85em; font-weight: bold; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

        .main-wrapper { display: flex; flex-grow: 1; overflow: hidden; }

        /* å·¦å´å°èˆª */
        .sidebar { 
            width: clamp(180px, 15vw, 300px); background: var(--sidebar-bg); 
            border-right: 3px solid var(--mabi-border); overflow-y: auto; flex-shrink: 0; 
        }
        .filter-btn { padding: 18px 20px; cursor: pointer; color: #a0aec0; border-left: 6px solid transparent; transition: 0.2s; }
        .filter-btn.active { background: rgba(74, 144, 226, 0.2); color: var(--mabi-highlight); border-left-color: var(--mabi-header); font-weight: bold; }

        /* å³å´å„€è¡¨æ¿ */
        .dashboard { 
            flex-grow: 1; padding: 25px; overflow-y: auto; background: #111827;
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px;
        }

        .mabi-window { background: var(--mabi-bg); border: 3px solid var(--mabi-border); border-radius: 6px; display: flex; flex-direction: column; }
        .mabi-header { background: var(--mabi-header); padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; }
        .channel-list { margin: 8px; background: var(--mabi-list-bg); border: 2px solid var(--mabi-border); }
        
        /* åˆ†æµåˆ—ï¼šé¡¯ç¤ºç‹€æ…‹æ–‡å­— */
        .ch-row { padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .ch-row.boarding { background-color: rgba(16, 185, 129, 0.25); }
        .ch-row.selected { border: 2px solid white; }

        .ch-status { font-size: 0.75em; padding: 2px 6px; border-radius: 4px; margin-left: 10px; font-weight: bold; }
        .st-boarding { background-color: var(--status-boarding); color: white; }
        .st-atsea { background-color: var(--status-atsea); color: white; }

        .timer-val { color: var(--timer-yellow); font-family: 'Courier New', monospace; font-weight: bold; font-size: var(--timer-font); }

        /* æ‰‹æ©Ÿé©é… */
        @media (max-width: 768px) {
            .main-wrapper { flex-direction: column; }
            .sidebar { width: 100%; height: auto; display: flex; flex-direction: row; border-right: none; border-bottom: 3px solid var(--mabi-border); overflow-x: auto; }
            .filter-btn { padding: 12px; white-space: nowrap; border-left: none; border-bottom: 4px solid transparent; }
            .filter-btn.active { border-bottom-color: var(--mabi-header); }
        }
    </style>
</head>
<body>

<div class="alerts-container">
    <div class="alert-label">âœ… é–‹æ”¾ç™»èˆ¹çš„åˆ†æµï¼š</div>
    <div class="grid-tags" id="arrivedTags"></div>
</div>

<div class="main-wrapper">
    <div class="sidebar">
        <div class="filter-btn active" onclick="setFilter('all')">ğŸŒ å…¨éƒ¨èˆªç·š</div>
        <div class="filter-btn" onclick="setFilter('1_å¡æ™®')">âš“ å¡æ™®</div>
        <div class="filter-btn" onclick="setFilter('2_è²å³¶')">ğŸ€ è²å³¶</div>
        <div class="filter-btn" onclick="setFilter('4_å…‹æ‹‰')">ğŸœï¸ å…‹æ‹‰</div>
        <div class="filter-btn" onclick="setFilter('6_å…‹è«¾æ–¯')">ğŸ« æ¯”è·¯é‡Œäº</div>
        <div class="filter-btn" onclick="setFilter('8_éŒ«æ‹‰')">â„ï¸ è²è¥¿æ–¯</div>
        <div class="filter-btn" onclick="setFilter('5_å‡±å®‰')">ğŸ–ï¸ å‡±å®‰</div>
    </div>
    <div class="dashboard" id="app"></div>
</div>

<script>
    // ä¾æ“š 3.outputData.html æ•¸æ“šèˆ‡ flight_const.html é€±æœŸå¸¸æ•¸
    const routes = [
        { id: "1_å¡æ™®", name: "1_å¡æ™® â†’ è²å³¶", cycle: 360, atJetty: 150, seeds: ["2026/02/01 21:35:01", "2026/02/01 21:35:04", "2026/02/01 21:34:49", "2026/02/01 21:33:05", "2026/02/01 21:32:57", "2026/02/01 21:35:01", "2026/02/01 21:34:41", "2026/02/01 21:34:49", "2026/02/01 21:34:35", "2026/02/01 21:35:00", "2026/02/01 21:34:41", "2026/02/01 21:38:29", "2026/02/01 21:37:00"] },
        { id: "2_è²å³¶", name: "2_è²å³¶ â†’ å¡æ™®", cycle: 360, atJetty: 150, seeds: ["2026/02/01 21:35:31", "2026/02/01 21:35:34", "2026/02/01 21:35:19", "2026/02/01 21:33:35", "2026/02/01 21:33:27", "2026/02/01 21:35:31", "2026/02/01 21:35:11", "2026/02/01 21:35:19", "2026/02/01 21:35:05", "2026/02/01 21:35:30", "2026/02/01 21:35:11", "2026/02/01 21:38:59", "2026/02/01 21:37:30"] },
        { id: "1_å¡æ™®", name: "3_å¡æ™® â†’ å…‹æ‹‰", cycle: 660, atJetty: 300, seeds: ["2026/02/01 21:44:31", "2026/02/01 21:44:34", "2026/02/01 21:44:20", "2026/02/01 21:42:34", "2026/02/01 21:42:28", "2026/02/01 21:44:30", "2026/02/01 21:44:11", "2026/02/01 21:44:19", "2026/02/01 21:44:05", "2026/02/01 21:44:31", "2026/02/01 21:44:11", "2026/02/01 21:41:58", "2026/02/01 21:41:29"] },
        { id: "4_å…‹æ‹‰", name: "4_å…‹æ‹‰ â†’ å¡æ™®", cycle: 660, atJetty: 300, seeds: ["2026/02/01 21:45:01", "2026/02/01 21:45:04", "2026/02/01 21:44:50", "2026/02/01 21:43:04", "2026/02/01 21:42:58", "2026/02/01 21:45:00", "2026/02/01 21:44:41", "2026/02/01 21:44:49", "2026/02/01 21:44:35", "2026/02/01 21:45:01", "2026/02/01 21:44:41", "2026/02/01 21:42:28", "2026/02/01 21:41:59"] },
        { id: "5_å‡±å®‰", name: "5_å‡±å®‰ â†’ å…‹è«¾æ–¯", cycle: 660, atJetty: 300, seeds: ["2026/02/01 21:45:01", "2026/02/01 21:45:04", "2026/02/01 21:44:49", "2026/02/01 21:43:04", "2026/02/01 21:42:58", "2026/02/01 21:45:01", "2026/02/01 21:44:41", "2026/02/01 21:44:48", "2026/02/01 21:44:35", "2026/02/01 21:45:01", "2026/02/01 21:44:41", "2026/02/01 21:42:29", "2026/02/01 21:42:00"] },
        { id: "6_å…‹è«¾æ–¯", name: "6_å…‹è«¾æ–¯ â†’ å‡±å®‰", cycle: 660, atJetty: 300, seeds: ["2026/02/01 21:45:31", "2026/02/01 21:45:34", "2026/02/01 21:45:19", "2026/02/01 21:43:34", "2026/02/01 21:43:28", "2026/02/01 21:45:31", "2026/02/01 21:45:11", "2026/02/01 21:45:18", "2026/02/01 21:45:05", "2026/02/01 21:45:31", "2026/02/01 21:45:11", "2026/02/01 21:42:59", "2026/02/01 21:42:30"] },
        { id: "5_å‡±å®‰", name: "7_å‡±å®‰ â†’ éŒ«æ‹‰", cycle: 660, atJetty: 300, seeds: ["2026/02/01 21:44:31", "2026/02/01 21:44:34", "2026/02/01 21:44:19", "2026/02/01 21:42:34", "2026/02/01 21:42:27", "2026/02/01 21:44:30", "2026/02/01 21:44:11", "2026/02/01 21:44:18", "2026/02/01 21:44:05", "2026/02/01 21:44:31", "2026/02/01 21:44:12", "2026/02/01 21:52:59", "2026/02/01 21:52:30"] },
        { id: "8_éŒ«æ‹‰", name: "8_éŒ«æ‹‰ â†’ å‡±å®‰", cycle: 660, atJetty: 300, seeds: ["2026/02/01 21:45:31", "2026/02/01 21:45:34", "2026/02/01 21:45:19", "2026/02/01 21:43:34", "2026/02/01 21:43:27", "2026/02/01 21:45:30", "2026/02/01 21:45:11", "2026/02/01 21:45:18", "2026/02/01 21:45:05", "2026/02/01 21:45:31", "2026/02/01 21:45:12", "2026/02/01 21:53:59", "2026/02/01 21:53:30"] }
    ];

    let currentFilter = 'all'; let expandedId = null;

    function setFilter(f) {
        currentFilter = f;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.onclick.toString().includes(f)));
        render();
    }

    function toggleDetail(id) { expandedId = (expandedId === id) ? null : id; render(); }

    function render() {
        const app = document.getElementById('app');
        const arrivedTags = document.getElementById('arrivedTags');
        const now = new Date();
        app.innerHTML = ''; arrivedTags.innerHTML = '';

        routes.forEach((route, rIdx) => {
            if (currentFilter !== 'all' && route.id !== currentFilter) return;

            const win = document.createElement('div');
            win.className = 'mabi-window';
            let winHtml = `<div class="mabi-header"><span>${route.name}</span><span>X</span></div><div class="channel-list">`;

            route.seeds.forEach((seedStr, cIdx) => {
                const diff = (now.getTime() - new Date(seedStr).getTime()) / 1000;
                const remain = (route.cycle - (diff % route.cycle)) % route.cycle;
                const isBoarding = remain <= route.atJetty; // åˆ¤å®šç™»èˆ¹é‚è¼¯
                
                const timeStr = `${Math.floor(remain/60)}:${Math.floor(remain%60).toString().padStart(2,'0')}`;
                const id = `${rIdx}_${cIdx}`;

                if (isBoarding) {
                    const port = route.name.split(' â†’ ')[0].slice(2);
                    arrivedTags.innerHTML += `<div class="tag-boarding">${port} CH${cIdx+1}</div>`;
                }

                winHtml += `
                    <div class="ch-row ${isBoarding ? 'boarding' : ''} ${expandedId === id ? 'selected' : ''}" onclick="toggleDetail('${id}')">
                        <span>CHANNEL ${cIdx+1} <span class="ch-status ${isBoarding ? 'st-boarding' : 'st-atsea'}">${isBoarding ? 'é–‹æ”¾ç™»èˆ¹' : 'æœªåˆ°æ¸¯'}</span></span>
                        <span class="timer-val">${timeStr}</span>
                    </div>`;
            });
            win.innerHTML = winHtml + '</div>'; app.appendChild(win);
        });
        if (!arrivedTags.innerHTML) arrivedTags.innerHTML = '<span style="color:#64748b; font-size:0.8em;">(æš«ç„¡é–‹æ”¾ç™»èˆ¹çš„åˆ†æµ)</span>';
    }

    setInterval(render, 1000); render();
</script>

</body>
</html>